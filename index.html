<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudyOS ‚Äî Gamified Study Planner</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet" />
</head>
<body>

  <!-- Animated background -->
  <div class="bg-layer" aria-hidden="true">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
    <canvas id="particles-canvas"></canvas>
  </div>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-logo">‚óà</div>
    </div>
  </div>

  <!-- ===== AUTH SCREEN ===== -->
  <div class="auth-screen hidden" id="authScreen">
    <div class="auth-card glass">
      <div class="auth-logo">
        <span class="auth-logo-icon">‚óà</span>
        <span class="auth-logo-text">StudyOS</span>
      </div>
      <div class="auth-tagline">Level up your learning.</div>

      <div class="auth-tabs">
        <button class="auth-tab active" data-auth-tab="login">Sign In</button>
        <button class="auth-tab" data-auth-tab="signup">Create Account</button>
      </div>

      <!-- Login -->
      <div class="auth-form active" id="authFormLogin">
        <div class="input-group">
          <label class="input-label" for="loginEmail">Email</label>
          <input type="email" class="input-field" id="loginEmail" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="input-group">
          <label class="input-label" for="loginPassword">Password</label>
          <input type="password" class="input-field" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
        </div>
        <div class="auth-error" id="loginError"></div>
        <button class="btn btn-primary btn-full" id="loginBtn">Sign In</button>
      </div>

      <!-- Signup -->
      <div class="auth-form" id="authFormSignup">
        <div class="input-group">
          <label class="input-label" for="signupEmail">Email</label>
          <input type="email" class="input-field" id="signupEmail" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="input-group">
          <label class="input-label" for="signupPassword">Password</label>
          <input type="password" class="input-field" id="signupPassword" placeholder="Min. 6 characters" autocomplete="new-password" />
        </div>
        <div class="input-group">
          <label class="input-label" for="signupConfirm">Confirm Password</label>
          <input type="password" class="input-field" id="signupConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password" />
        </div>
        <div class="auth-error" id="signupError"></div>
        <button class="btn btn-primary btn-full" id="signupBtn">Create Account</button>
      </div>
    </div>
  </div>

  <!-- ===== ONBOARDING SCREEN ===== -->
  <div class="onboarding-screen hidden" id="onboardingScreen">
    <div class="onboarding-card glass">
      <div class="ob-progress">
        <div class="ob-dot active" data-step="0"></div>
        <div class="ob-dot" data-step="1"></div>
        <div class="ob-dot" data-step="2"></div>
      </div>

      <!-- Step 0: Name -->
      <div class="ob-step active" data-step="0">
        <div class="ob-icon">üëã</div>
        <h2 class="ob-title">Welcome to StudyOS!</h2>
        <p class="ob-subtitle">Let's set up your profile in 3 quick steps.</p>
        <div class="input-group">
          <label class="input-label" for="obName">What's your name?</label>
          <input type="text" class="input-field" id="obName" placeholder="e.g. Alex..." autocomplete="given-name" />
        </div>
        <div class="input-group">
          <label class="input-label" for="obUsername">Choose a username</label>
          <input type="text" class="input-field" id="obUsername" placeholder="e.g. scholar_alex..." />
        </div>
        <div class="auth-error" id="obError0"></div>
        <button class="btn btn-primary btn-full ob-next" data-next="1">Continue ‚Üí</button>
      </div>

      <!-- Step 1: Goal + Subjects -->
      <div class="ob-step" data-step="1">
        <div class="ob-icon">üéØ</div>
        <h2 class="ob-title">Set your goal</h2>
        <p class="ob-subtitle">How many hours do you want to study per day?</p>
        <div class="goal-options">
          <button class="goal-btn" data-goal="1">1 hr</button>
          <button class="goal-btn active" data-goal="2">2 hrs</button>
          <button class="goal-btn" data-goal="3">3 hrs</button>
          <button class="goal-btn" data-goal="4">4+ hrs</button>
        </div>
        <div class="input-group" style="margin-top:24px">
          <label class="input-label" for="obSubjects">What are you studying? <span style="color:var(--text-muted)">(comma separated)</span></label>
          <input type="text" class="input-field" id="obSubjects" placeholder="e.g. Math, Biology, History..." />
        </div>
        <div class="auth-error" id="obError1"></div>
        <div class="ob-btn-row">
          <button class="btn btn-ghost ob-back" data-back="0">‚Üê Back</button>
          <button class="btn btn-primary ob-next" data-next="2">Continue ‚Üí</button>
        </div>
      </div>

      <!-- Step 2: Avatar + Theme -->
      <div class="ob-step" data-step="2">
        <div class="ob-icon">‚ú®</div>
        <h2 class="ob-title">Almost there!</h2>
        <p class="ob-subtitle">Pick your avatar color and theme.</p>
        <div class="avatar-preview" id="obAvatarPreview" style="background:#7c6af7">A</div>
        <div class="color-picker" id="obColorPicker">
          <button class="color-dot active" data-color="#7c6af7" style="background:#7c6af7"></button>
          <button class="color-dot" data-color="#f7716a" style="background:#f7716a"></button>
          <button class="color-dot" data-color="#45d9a0" style="background:#45d9a0"></button>
          <button class="color-dot" data-color="#f7c76a" style="background:#f7c76a"></button>
          <button class="color-dot" data-color="#6ab8f7" style="background:#6ab8f7"></button>
          <button class="color-dot" data-color="#f76ab8" style="background:#f76ab8"></button>
        </div>
        <div class="theme-choice">
          <button class="theme-choice-btn active" data-theme-choice="dark">üåô Dark</button>
          <button class="theme-choice-btn" data-theme-choice="light">‚òÄÔ∏è Light</button>
        </div>
        <div class="ob-btn-row">
          <button class="btn btn-ghost ob-back" data-back="1">‚Üê Back</button>
          <button class="btn btn-primary" id="obFinishBtn" style="flex:1">Let's Go! üöÄ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== MAIN APP ===== -->
  <div class="app-wrapper hidden" id="appWrapper">

    <aside class="sidebar" id="sidebar" role="navigation">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">‚óà</span>
          <span class="logo-text">StudyOS</span>
        </div>
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
          <span class="toggle-icon">‚Äπ</span>
        </button>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-item active" data-view="dashboard"><span class="nav-icon">‚¨°</span><span class="nav-label">Dashboard</span></button>
        <button class="nav-item" data-view="tasks"><span class="nav-icon">‚ó´</span><span class="nav-label">Tasks</span></button>
        <button class="nav-item" data-view="pomodoro"><span class="nav-icon">‚óâ</span><span class="nav-label">Pomodoro</span></button>
        <button class="nav-item" data-view="analytics"><span class="nav-icon">‚óà</span><span class="nav-label">Analytics</span></button>
        <button class="nav-item" data-view="achievements"><span class="nav-icon">‚¨ü</span><span class="nav-label">Achievements</span></button>
      </nav>

      <div class="sidebar-player">
        <div class="player-level-badge" id="sidebarLevelBadge">
          <span class="level-num" id="sidebarLevel">1</span>
          <span class="level-label">LVL</span>
        </div>
        <div class="player-info">
          <div class="player-name" id="sidebarName">Scholar</div>
          <div class="xp-bar-mini"><div class="xp-fill-mini" id="xpFillMini"></div></div>
          <div class="xp-text-mini" id="xpTextMini">0 / 100 XP</div>
        </div>
      </div>
    </aside>

    <div class="main-wrapper" id="mainWrapper">
      <header class="topnav" role="banner">
        <div class="topnav-left">
          <h1 class="page-title" id="pageTitle">Dashboard</h1>
          <span class="page-subtitle" id="pageSubtitle">Your learning command center</span>
        </div>
        <div class="topnav-right">
          <div class="streak-badge" title="Daily Streak">
            <span class="streak-fire">üî•</span>
            <span class="streak-count" id="streakCount">0</span>
          </div>
          <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
            <span class="theme-icon" id="themeIcon">‚óë</span>
          </button>
          <div class="user-menu-wrap">
            <button class="user-avatar" id="userAvatarBtn" style="background:#7c6af7">A</button>
            <div class="user-dropdown glass" id="userDropdown">
              <div class="user-dropdown-info">
                <div class="ud-name" id="udName">Scholar</div>
                <div class="ud-email" id="udEmail">user@example.com</div>
              </div>
              <hr class="ud-divider" />
              <button class="ud-item" id="signOutBtn">Sign Out</button>
            </div>
          </div>
        </div>
      </header>

      <main class="content" role="main">

        <!-- DASHBOARD -->
        <section class="view active" id="view-dashboard">
          <div class="stats-grid">
            <div class="stat-card glass stagger-1"><div class="stat-icon">‚ó´</div><div class="stat-body"><div class="stat-value" id="statTotalTasks">0</div><div class="stat-label">Total Tasks</div></div><div class="stat-glow"></div></div>
            <div class="stat-card glass stagger-2"><div class="stat-icon">‚úì</div><div class="stat-body"><div class="stat-value" id="statCompletedTasks">0</div><div class="stat-label">Completed</div></div><div class="stat-glow"></div></div>
            <div class="stat-card glass stagger-3"><div class="stat-icon">‚óâ</div><div class="stat-body"><div class="stat-value" id="statPomodoros">0</div><div class="stat-label">Pomodoros</div></div><div class="stat-glow"></div></div>
            <div class="stat-card glass stagger-4"><div class="stat-icon">‚¨ü</div><div class="stat-body"><div class="stat-value" id="statXP">0</div><div class="stat-label">Total XP</div></div><div class="stat-glow"></div></div>
          </div>

          <div class="dash-mid-row">
            <div class="player-card glass stagger-2">
              <div class="player-card-header">
                <div class="player-avatar-big" id="playerAvatarBig" style="background:#7c6af7">S</div>
                <div class="player-card-info">
                  <div class="player-card-name" id="playerCardName">Scholar</div>
                  <div class="player-card-level" id="playerCardLevel">Level 1 ‚Äî Novice</div>
                </div>
              </div>
              <div class="xp-section">
                <div class="xp-label-row"><span>XP Progress</span><span id="xpLabel">0 / 100</span></div>
                <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
              </div>
              <div class="player-stats-row">
                <div class="pstat"><div class="pstat-val" id="pstatStreak">0</div><div class="pstat-label">Streak</div></div>
                <div class="pstat"><div class="pstat-val" id="pstatScore">0%</div><div class="pstat-label">Score</div></div>
                <div class="pstat"><div class="pstat-val" id="pstatLevel">1</div><div class="pstat-label">Level</div></div>
              </div>
            </div>

            <div class="quick-add-card glass stagger-3">
              <div class="card-title">Quick Add Task</div>
              <div class="quick-form">
                <input type="text" class="input-field" id="quickTaskTitle" placeholder="Task title..." />
                <select class="input-field" id="quickTaskSubject"><option value="">Select subject...</option></select>
                <div class="quick-row">
                  <input type="date" class="input-field" id="quickTaskDue" />
                  <select class="input-field" id="quickTaskPriority">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>
                <input type="number" class="input-field" id="quickTaskTime" placeholder="Est. minutes..." min="1" />
                <button class="btn btn-primary" id="quickAddBtn">+ Add Task</button>
              </div>
            </div>
          </div>

          <div class="glass card-section stagger-4">
            <div class="section-header">
              <div class="card-title">Recent Tasks</div>
              <button class="btn btn-ghost" data-view="tasks">View All ‚Üí</button>
            </div>
            <div class="task-list" id="recentTaskList"><div class="empty-state">No tasks yet. Add your first task above!</div></div>
          </div>
        </section>

        <!-- TASKS -->
        <section class="view" id="view-tasks">
          <div class="tasks-toolbar glass">
            <div class="toolbar-left">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="pending">Pending</button>
              <button class="filter-btn" data-filter="completed">Completed</button>
            </div>
            <div class="toolbar-right">
              <select class="input-field input-sm" id="sortSelect">
                <option value="date">Sort: Due Date</option>
                <option value="priority">Sort: Priority</option>
              </select>
              <button class="btn btn-primary btn-sm" id="openAddTaskModal">+ New Task</button>
            </div>
          </div>
          <div class="subjects-container" id="subjectsContainer"><div class="empty-state glass">No subjects yet. Add a subject to get started!</div></div>
          <button class="btn btn-ghost add-subject-btn" id="openAddSubjectModal">+ Add Subject</button>
        </section>

        <!-- POMODORO -->
        <section class="view" id="view-pomodoro">
          <div class="pomo-layout">
            <div class="pomo-card glass">
              <div class="pomo-header">
                <div class="card-title">Pomodoro Timer</div>
                <div class="pomo-session-count">Sessions today: <strong id="pomoDaySessions">0</strong></div>
              </div>
              <div class="pomo-ring-wrap">
                <svg class="pomo-ring" viewBox="0 0 200 200">
                  <circle class="ring-bg" cx="100" cy="100" r="85" />
                  <circle class="ring-progress" id="ringProgress" cx="100" cy="100" r="85" stroke-dasharray="534" stroke-dashoffset="0" />
                </svg>
                <div class="pomo-time-display">
                  <div class="pomo-time" id="pomoTime">25:00</div>
                  <div class="pomo-mode" id="pomoMode">FOCUS</div>
                </div>
              </div>
              <div class="pomo-controls">
                <button class="btn btn-ghost btn-icon" id="pomoReset">‚Ü∫</button>
                <button class="btn btn-primary btn-lg" id="pomoStartPause">Start</button>
                <button class="btn btn-ghost btn-icon" id="pomoSkip">‚á•</button>
              </div>
              <div class="pomo-presets">
                <button class="preset-btn active" data-work="25" data-break="5">25/5</button>
                <button class="preset-btn" data-work="50" data-break="10">50/10</button>
                <button class="preset-btn" data-work="90" data-break="20">90/20</button>
              </div>
              <div class="pomo-task-selector">
                <label class="input-label" for="pomoTaskSelect">Studying:</label>
                <select class="input-field" id="pomoTaskSelect"><option value="">‚Äî Select a task ‚Äî</option></select>
              </div>
            </div>
            <div class="pomo-stats-col">
              <div class="glass pomo-stat-card stagger-1"><div class="ps-icon">‚óâ</div><div class="ps-val" id="totalPomoSessions">0</div><div class="ps-label">Total Sessions</div></div>
              <div class="glass pomo-stat-card stagger-2"><div class="ps-icon">‚è±</div><div class="ps-val" id="totalPomoMinutes">0</div><div class="ps-label">Minutes Focused</div></div>
              <div class="glass pomo-stat-card stagger-3"><div class="ps-icon">‚¨ü</div><div class="ps-val" id="pomoXpEarned">0</div><div class="ps-label">XP Earned</div></div>
            </div>
          </div>
        </section>

        <!-- ANALYTICS -->
        <section class="view" id="view-analytics">
          <div class="analytics-grid">
            <div class="glass analytics-card stagger-1">
              <div class="card-title">Completion Rate</div>
              <div class="big-stat" id="completionRate">0%</div>
              <div class="analytics-bar-wrap"><div class="analytics-bar"><div class="analytics-fill" id="completionFill" style="width:0%"></div></div></div>
              <div class="analytics-sub" id="completionSub">0 of 0 tasks complete</div>
            </div>
            <div class="glass analytics-card stagger-2">
              <div class="card-title">Productivity Score</div>
              <div class="big-stat" id="productivityScore">0</div>
              <div class="analytics-sub">Based on streak &amp; completion</div>
              <div class="analytics-bar-wrap"><div class="analytics-bar"><div class="analytics-fill prod-fill" id="productivityFill" style="width:0%"></div></div></div>
            </div>
            <div class="glass analytics-card stagger-3">
              <div class="card-title">Weekly Study Time</div>
              <div class="big-stat" id="weeklyMinutes">0<span class="unit">m</span></div>
              <div class="analytics-sub">Minutes this week</div>
            </div>
            <div class="glass analytics-card stagger-4">
              <div class="card-title">XP Progress</div>
              <div class="big-stat" id="analyticsXP">0</div>
              <div class="analytics-sub" id="analyticsLevel">Level 1 ‚Äî Novice</div>
              <div class="analytics-bar-wrap"><div class="analytics-bar"><div class="analytics-fill xp-bar-fill" id="analyticsXpFill" style="width:0%"></div></div></div>
            </div>
          </div>
          <div class="glass analytics-breakdown stagger-3">
            <div class="card-title">Tasks by Priority</div>
            <div class="priority-breakdown">
              <div class="pb-row"><span class="pb-label priority-high">High</span><div class="analytics-bar flex1"><div class="analytics-fill high-fill" id="highFill" style="width:0%"></div></div><span class="pb-count" id="highCount">0</span></div>
              <div class="pb-row"><span class="pb-label priority-medium">Medium</span><div class="analytics-bar flex1"><div class="analytics-fill med-fill" id="medFill" style="width:0%"></div></div><span class="pb-count" id="medCount">0</span></div>
              <div class="pb-row"><span class="pb-label priority-low">Low</span><div class="analytics-bar flex1"><div class="analytics-fill low-fill" id="lowFill" style="width:0%"></div></div><span class="pb-count" id="lowCount">0</span></div>
            </div>
          </div>
        </section>

        <!-- ACHIEVEMENTS -->
        <section class="view" id="view-achievements">
          <div class="achievements-grid" id="achievementsGrid"></div>
        </section>

      </main>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal-overlay" id="addTaskModal" role="dialog" aria-modal="true">
    <div class="modal glass">
      <div class="modal-header"><h2 class="modal-title">Add New Task</h2><button class="modal-close" data-modal="addTaskModal">‚úï</button></div>
      <div class="modal-body">
        <label class="input-label" for="modalTaskTitle">Title</label>
        <input type="text" class="input-field" id="modalTaskTitle" placeholder="Task title..." />
        <label class="input-label" for="modalTaskSubjectSelect">Subject</label>
        <select class="input-field" id="modalTaskSubjectSelect"><option value="">Select subject...</option></select>
        <label class="input-label" for="modalTaskDue">Due Date</label>
        <input type="date" class="input-field" id="modalTaskDue" />
        <label class="input-label" for="modalTaskPriority">Priority</label>
        <select class="input-field" id="modalTaskPriority"><option value="low">Low</option><option value="medium" selected>Medium</option><option value="high">High</option></select>
        <label class="input-label" for="modalTaskTime">Estimated Time (minutes)</label>
        <input type="number" class="input-field" id="modalTaskTime" placeholder="30" min="1" />
      </div>
      <div class="modal-footer">
        <button class="btn btn-ghost" data-modal="addTaskModal">Cancel</button>
        <button class="btn btn-primary" id="modalAddTaskBtn">Add Task</button>
      </div>
    </div>
  </div>

  <!-- Add Subject Modal -->
  <div class="modal-overlay" id="addSubjectModal" role="dialog" aria-modal="true">
    <div class="modal glass">
      <div class="modal-header"><h2 class="modal-title">Add New Subject</h2><button class="modal-close" data-modal="addSubjectModal">‚úï</button></div>
      <div class="modal-body">
        <label class="input-label" for="subjectName">Subject Name</label>
        <input type="text" class="input-field" id="subjectName" placeholder="e.g. Mathematics..." />
        <label class="input-label">Color</label>
        <div class="color-picker" id="subjectColorPicker">
          <button class="color-dot active" data-color="#7c6af7" style="background:#7c6af7"></button>
          <button class="color-dot" data-color="#f7716a" style="background:#f7716a"></button>
          <button class="color-dot" data-color="#45d9a0" style="background:#45d9a0"></button>
          <button class="color-dot" data-color="#f7c76a" style="background:#f7c76a"></button>
          <button class="color-dot" data-color="#6ab8f7" style="background:#6ab8f7"></button>
          <button class="color-dot" data-color="#f76ab8" style="background:#f76ab8"></button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-ghost" data-modal="addSubjectModal">Cancel</button>
        <button class="btn btn-primary" id="addSubjectBtn">Add Subject</button>
      </div>
    </div>
  </div>

  <!-- Level Up Modal -->
  <div class="modal-overlay" id="levelUpModal" role="dialog" aria-modal="true">
    <div class="modal glass level-up-modal">
      <div class="level-up-content">
        <div class="level-up-icon">‚¨ü</div>
        <h2 class="level-up-title">Level Up!</h2>
        <div class="level-up-num" id="levelUpNum">2</div>
        <div class="level-up-name" id="levelUpName">Apprentice</div>
        <button class="btn btn-primary btn-lg" data-modal="levelUpModal">Awesome! ‚ú®</button>
      </div>
      <canvas class="confetti-canvas" id="confettiCanvas"></canvas>
    </div>
  </div>

  <!-- Achievement Toast -->
  <div class="achievement-toast" id="achievementToast" role="status" aria-live="polite">
    <div class="toast-icon">‚¨ü</div>
    <div class="toast-body">
      <div class="toast-title">Achievement Unlocked!</div>
      <div class="toast-name" id="toastName">First Steps</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js"></script>
</body>
</html>
